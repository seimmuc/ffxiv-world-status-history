{% extends "ffxivws/base.html.jinja" %}
{% from 'ffxivws/common.html.jinja' import timezone_head, timezones_form %}

{% block head_extra %}
  {{- timezone_head() -}}
{% endblock %}

{% block title %}World {{ world.name }}{% endblock %}

{% macro world_icon(icon_name, size, tooltip_text) -%}
  <div class="world-icon {{ size }} world-icon-{{ icon_name|lower }}"{% if tooltip_text %} tooltip-text="{{ tooltip_text }}"{% endif %}></div>
{%- endmacro %}

{% macro icons_from_summary(summary, attr_name) -%}
  {% if summary is none %}
    {{ world_icon(attr_name + '-unknown', 'regular', 'No data') }}
  {% elif summary[attr_name]|length == 1 %}
    {{ world_icon(attr_name + '-' + (summary[attr_name]|first).value|string, 'regular', (summary[attr_name]|first).label) }}
  {% else %}
    <div class="world-icon-grid" tooltip-text="{% for val in summary[attr_name] %}{{ val.label + ('' if loop.last else '<br>') }}{% endfor %}">
     {% for val in summary[attr_name] %}
      {{ world_icon('{}-{}'.format(attr_name, val), 'small') }}
     {% endfor %}
    </div>
  {% endif %}
{%- endmacro %}

{% block body %}
<body>
  <h2 id="world-history-name">{{ world.name }}</h2>
  <main id="world-main">
    <div id="world-history-table">
      <table>
       {% for day, summary in days %}
        <tr class="world-history-row{% if day == today %} today{% endif %}">
          <td class="day">{% if day == today %}Today{% else %}{{ day.strftime('%x') }}{% endif %}</td>
          <td tooltip-text="{% if summary.snapshot_count == 1 %}1 snapshot{% else %}{{ summary.snapshot_count or 0 }} snapshots{% endif %}">{{ summary.snapshot_count or 0 }}</td>
          <td>{{ icons_from_summary(summary, 'status') }}</td>
          <td>{{ icons_from_summary(summary, 'classification') }}</td>
          <td>{{ icons_from_summary(summary, 'charcreate') }}</td>
        </tr>
       {% endfor %}
      </table>
    </div>
  </main>

  <footer id="footer">
    {{ timezones_form(csrf_input, timezones, current_tz, request.get_full_path()) }}
  </footer>
</body>
{% endblock %}